<!DOCTYPE html>
<html>
  <head>
    <title>Google Maps Type-Ahead Search</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1ZkFouCHsxdjHEUWg6HtRTVmtnyJKLOs&libraries=places"></script>
  </head>
  <body>
    <input id="search" type="text" placeholder="Enter a location">
    <div id="map" style="height: 500px;"></div>
    <script>
      var map, places, infoWindow;
      var markers = [];
      var autocomplete;
      var countryRestrict = {country: 'us'};
      
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 37.0902, lng: -95.7129},
          zoom: 5
        });
        infoWindow = new google.maps.InfoWindow();
        places = new google.maps.places.PlacesService(map);
        
        autocomplete = new google.maps.places.Autocomplete(
          document.getElementById('search'), {
            types: ['geocode'],
            componentRestrictions: countryRestrict
          });
          
        autocomplete.addListener('place_changed', onPlaceChanged);
        
        // Create the markers array
        var markers = [];

        // Add True West Coffee marker to the markers array
        var trueWestCoffee = new google.maps.Marker({
          position: { lat: 39.3957, lng: -84.5671 },
          title: "True West Coffee",
          map: map
        });
        markers.push(trueWestCoffee);

        // Add Starbucks marker to the markers array
        var starbucks = new google.maps.Marker({
          position: { lat: 39.4063, lng: -84.5713 },
          title: "Starbucks",
          map: map
        });
        markers.push(starbucks);
      }
      
      function onPlaceChanged() {
        var place = autocomplete.getPlace();
        if (place.geometry) {
          map.panTo(place.geometry.location);
          map.setZoom(15);
          search();
        } else {
          document.getElementById('search').placeholder = 'Enter a location';
        }
      }
      
      function search() {
        var search = {
          bounds: map.getBounds(),
          types: ['postal_code', 'postal_code_prefix']
        };
        
        places.nearbySearch(search, function(results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            clearMarkers();
            for (var i = 0; i < results.length; i++) {
              var markerLatLng = new google.maps.LatLng(results[i].geometry.location.lat(), results[i].geometry.location.lng());
              var marker = new google.maps.Marker({
                position: markerLatLng,
                map: map
              });
              markers.push(marker);
              google.maps.event.addListener(marker, 'click', function() {
                infoWindow.setContent(this.content);
                infoWindow.open(map, this);
              });
            }
          }
        });
      }
      
      function clearMarkers() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        }
        markers = [];
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1ZkFouCHsxdjHEUWg6HtRTVmtnyJKLOs&libraries=places&callback=initMap"></script>
  </body>
</html>
